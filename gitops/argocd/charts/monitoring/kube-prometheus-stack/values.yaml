# Copyright (C) 2021 Nicolas Lamirault <nicolas.lamirault@gmail.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
kube-prometheus-stack:
  commonLabels:
    portefaix.xyz/version: v0.28.0
    monitoring: portefaix

  defaultRules:
    create: false
    # runbookUrl: "https://github.com/portefaix/portefaix/tree/master/runbook.md#"
  
  global:
    rbac:
      create: true
      pspEnabled: false

  alertmanager:
    enabled: true
    annotations:
      a8r.io/description: Default Prometheus rules
      a8r.io/owner: prometheus-community
      a8r.io/bugs: https://github.com/prometheus-community/helm-charts/issues
      a8r.io/documentation: https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack
      a8r.io/repository: https://github.com/prometheus-community/helm-charts
      a8r.io/support: https://github.com/prometheus-community/helm-charts/issues
    serviceAccount:
      create: true
      name: alertmanager
    tplConfig: false
    ingress:
      enabled: false
    serviceMonitor:
      selfMonitor: true
    alertmanagerSpec:
      logFormat: json
      logLevel: info

  grafana:
    enabled: false

  kubeApiServer:
    enabled: true

  kubelet:
    enabled: true

  kubeControllerManager:
    enabled: true

  coreDns:
    enabled: true

  kubeDns:
    enabled: false

  kubeEtcd:
    enabled: true

  kubeProxy:
    enabled: true

  kubeScheduler:
    enabled: true

  kubeStateMetrics:
    enabled: true
    selfMonitor:
      enabled: true

  kube-state-metrics:
    podSecurityPolicy:
      enabled: false

  nodeExporter:
    enabled: true

  prometheus-node-exporter:
    rbac:
      pspEnabled: false
    podLabels:
      portefaix.xyz/version: v0.28.0

  ## Configuration for prometheus-node-exporter subchart
  # prometheus-node-exporter:

  prometheusOperator:
    enabled: true
    serviceAccount:
      create: true
      name: prometheus-operator
    serviceMonitor:
      selfMonitor: true
    # image:
    #   repository: quay.io/prometheus-operator/prometheus-operator
    #   tag: v0.43.1
    tls:
      enabled: false
    ## Admission webhook support for PrometheusRules resources added in Prometheus Operator 0.30 can be enabled to prevent incorrectly formatted
    ## rules from making their way into prometheus and potentially preventing the container from starting
    admissionWebhooks:
      enabled: false
    podLabels:
      portefaix.xyz/version: v0.28.0

  prometheus:
    enabled: true
    annotations:
      a8r.io/description: Default Prometheus rules
      a8r.io/owner: prometheus-community
      a8r.io/bugs: https://github.com/prometheus-community/helm-charts/issues
      a8r.io/documentation: https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack
      a8r.io/repository: https://github.com/prometheus-community/helm-charts
      a8r.io/support: https://github.com/prometheus-community/helm-charts/issues
    serviceAccount:
      create: true
      name: prometheus
    thanosService:
      enabled: true
    thanosServiceMonitor:
      enabled: true
    thanosIngress:
      enabled: false
    ingress:
      enabled: false
    serviceMonitor:
      selfMonitor: true
    prometheusSpec:
      enableAdminAPI: true
      ruleNamespaceSelector: {}
      ruleSelector:
        matchLabels:
          monitoring: portefaix
      serviceMonitorSelector:
        matchLabels:
          monitoring: portefaix
      serviceMonitorNamespaceSelector: {}
      podMonitorSelector:
        matchLabels:
          monitoring: portefaix
      podMonitorNamespaceSelector: {}
      probeSelector:
        matchLabels:
          monitoring: portefaix
      probeNamespaceSelector: {}
      retention: 7d
      logLevel: info
      logFormat: json
      additionalScrapeConfigs: []
      thanos:
        logFormat: json
        logLevel: info
        objectStorageConfig:
          name: thanos-objstore-config
          key: object-store.yaml
    additionalServiceMonitors:
      - name: argocd-metrics
        selector:
          matchLabels:
            app.kubernetes.io/name: argocd-metrics
        namespaceSelector:
          matchNames: ["argocd"]
        endpoints:
          - port: metrics
      - name: argocd-server-metrics
        selector:
          matchLabels:
            app.kubernetes.io/name: argocd-server-metrics
        namespaceSelector:
          matchNames: ["argocd"]
        endpoints:
          - port: metrics
      - name: argocd-repo-server-metrics
        selector:
          matchLabels:
            app.kubernetes.io/name: argocd-repo-server-metrics
        namespaceSelector:
          matchNames: ["argocd"]
        endpoints:
          - port: metrics
    additionalPodMonitors: []
