# Copyright (C) Nicolas Lamirault <nicolas.lamirault@gmail.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0

---
ingress:
  enabled: false

events:
  destinations:
  - name: loki
    type: loki
    url: http://loki.loki.svc:3100/loki/api/v1/push
  - name: quickwit
    type: otlp
    url: http://quickwit-indexer.opentelemetry.svc.cluster.local:7281
    logs:
      enabled: true
  - name: grafana_cloud
    type: loki
    url: https://logs-prod-eu-west-0.grafana.net/loki/api/v1/push
    logs:
      enabled: true
    auth:
      type: basic
      username: "my-username"
      password: "my-password"
      tenantIdFrom: env("LOKI_TENANT_ID")
  clusterEvents:
    enabled: true
    destinations:
    - loki
    - quickwit
    - grafana_cloud
  integrations:
    enabled: true # TODO: must be disabled ?
  selfReporting:
    enabled: true
  alloy-singleton:
    enabled: true
    alloy:
      stabilityLevel: experimental
    logging:
      level: info
      format: json
    liveDebugging:
      enabled: true

logs:
  destinations:
  - name: loki
    type: loki
    url: http://loki.loki.svc:3100/loki/api/v1/push
  - name: quickwit
    type: otlp
    url: http://quickwit-indexer.opentelemetry.svc.cluster.local:7281
    logs:
      enabled: true
  - name: grafana_cloud
    type: loki
    url: https://logs-prod-eu-west-0.grafana.net/loki/api/v1/push
    logs:
      enabled: true
    auth:
      type: basic
      username: "my-username"
      password: "my-password"
      tenantIdFrom: env("LOKI_TENANT_ID")
  podLogs:
    enabled: true
    destinations:
    - loki
    - quickwit
    - grafana_cloud
  selfReporting:
    enabled: true
  integrations:
    enabled: true # TODO: must be disabled
  alloy-logs:
    enabled: true
    alloy:
      stabilityLevel: experimental
    logging:
      level: info
      format: json
    liveDebugging:
      enabled: true

metrics:
  destinations:
  - name: mimir
    type: prometheus
    url: http://mimir-gateway.monitoring.svc.cluster.local:80/api/v1/push
  - name: grafana_cloud
    type: prometheus
    url: https://prometheus-prod-01-eu-west-0.grafana.net/api/prom/push
    metrics:
      enabled: true
    auth:
      type: basic
      username: "my-username"
      password: "my-password"
      tenantIdFrom: env("PROMETHEUS_TENANT_ID")
  clusterMetrics:
    enabled: false
  prometheusOperatorObjects:
    enabled: true
    destinations:
    - mimir
    - grafana_cloud
    crds:
      deploy: false
      podMonitors:
        enabled: true
        selector:
          prometheus.io/operator: portefaix
      probes:
        enabled: true
        selector:
          prometheus.io/operator: portefaix
      serviceMonitors:
        enabled: true
        selector:
          prometheus.io/operator: portefaix
  selfReporting:
    enabled: true
  alloy-metrics:
    enabled: true
    alloy:
      stabilityLevel: experimental
    logging:
      level: info
      format: json
    liveDebugging:
      enabled: true

traces:
  destinations:
  - name: tempo
    type: otlp
    url: http://tempo-distributor.tracing.svc.cluster.local:4317
    traces:
      enabled: true
  - name: quickwit
    type: otlp
    url: http://quickwit-indexer.opentelemetry.svc.cluster.local:7281
    traces:
      enabled: true
  - name: grafana_cloud
    type: otlp
    url: http://tempo-eu-west-0.grafana.net:443
    traces:
      enabled: true
    auth:
      type: basic
      username: "my-username"
      password: "my-password"
      tenantIdFrom: env("LOKI_TENANT_ID")
  applicationObservability:
    enabled: true
    destinations:
    - loki
    - quickwit
    - grafana_cloud
    receivers:
      grpc:
        enabled: true
  integrations:
    enabled: true # TODO: must be disabled ?
  selfReporting:
    enabled: true
  alloy-receiver:
    enabled: true
    alloy:
      stabilityLevel: experimental
      extraPorts:
      - name: otlp-grpc
        port: 4317
        targetPort: 4317
        protocol: TCP
    logging:
      level: info
      format: json
    liveDebugging:
      enabled: true

profiles:
  destinations:
  - name: pyroscope
    type: pyroscope
    url: http://pyroscope.profiling.svc.cluster.local:4040
  profiling:
    enabled: true
    destinations:
    - pyroscope
  integrations:
    enabled: true # TODO: must be disabled ?
  selfReporting:
    enabled: true
  alloy-profiles:
    enabled: true
    alloy:
      stabilityLevel: experimental
    logging:
      level: info
      format: json
    liveDebugging:
      enabled: true

observability:
  clusterMetrics:
    enabled: false
  clusterEvents:
    enabled: false
  podLogs:
    enabled: false
  applicationObservability:
    enabled: true

  annotationAutodiscovery:
    enabled: false
  prometheusOperatorObjects:
    enabled: false
  profiling:
    enabled: false
  integrations:
    enabled: false
  selfReporting:
    enabled: true
  alloy-metrics:
    enabled: false
  alloy-singleton:
    enabled: false
  alloy-logs:
    enabled: false
  alloy-receiver:
    enabled: false
  alloy-profile:
    enabled: false
