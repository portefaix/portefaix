---
# Copyright (C) Nicolas Lamirault <nicolas.lamirault@gmail.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0

opentelemetry-operator:
  additionalLabels:
    portefaixVersion: v0.54.0

  manager:
    image:
      repository: ghcr.io/open-telemetry/opentelemetry-operator/opentelemetry-operator
    collectorImage:
      repository: ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib
    targetAllocatorImage:
      repository: ghcr.io/open-telemetry/opentelemetry-operator/target-allocator
    autoInstrumentationImage:
      java:
        repository: ghcr.io/open-telemetry/opentelemetry-operator/autoinstrumentation-java
      nodejs:
        repository: ghcr.io/open-telemetry/opentelemetry-operator/autoinstrumentation-nodejs
      python:
        repository: ghcr.io/open-telemetry/opentelemetry-operator/autoinstrumentation-python
      dotnet:
        repository: ghcr.io/open-telemetry/opentelemetry-operator/autoinstrumentation-dotnet
      go:
        repository: ghcr.io/open-telemetry/opentelemetry-operator/autoinstrumentation-go

    serviceMonitor:
      enabled: true
      extraLabels:
        prometheus.io/operator: portefaix

      prometheusRule:
        enabled: true
        groups: []
        defaultRules:
          enabled: true
        extraLabels:
          prometheus.io/operator: portefaix

autoinstrumentation:
  enabled: true
  name: core
  exporter:
    protocol: grpc
    insecure: true
    grpc:
      endpoint: http://alloy-alloy-gateway.opentelemetry.svc.cluster.local:4318
    http:
      endpoint: http://alloy-alloy-gateway.opentelemetry.svc.cluster.local:4318
  propagators:
  - tracecontext
  - baggage
  sampler:
    type: parentbased_traceidratio
    argument: "1"
  env:
  - name: OTEL_LOGS_EXPORTER
    value: otlp
  - name: OTEL_METRICS_EXPORTER
    value: otlp
  - name: OTEL_TRACES_EXPORTER
    value: otlp
  # - name: OTEL_EXPORTER_OTLP_HEADERS
  #   value: 'Authorization=Basic x'
  python:
    env:
    - name: OTEL_EXPORTER_OTLP_LOGS_ENDPOINT
      value: http://alloy-alloy-logs.opentelemetry.svc.cluster.local:4318
    - name: OTEL_EXPORTER_OTLP_METRICS_ENDPOINT
      value: http://alloy-alloy-metrics.opentelemetry.svc.cluster.local:4318
    - name: OTEL_EXPORTER_OTLP_TRACES_ENDPOINT
      value: http://alloy-alloy-traces.opentelemetry.svc.cluster.local:4318
  dotnet:
    env:
    - name: OTEL_EXPORTER_OTLP_LOGS_ENDPOINT
      value: http://alloy-alloy-logs.opentelemetry.svc.cluster.local:4318
    - name: OTEL_EXPORTER_OTLP_METRICS_ENDPOINT
      value: http://alloy-alloy-metrics.opentelemetry.svc.cluster.local:4318
    - name: OTEL_EXPORTER_OTLP_TRACES_ENDPOINT
      value: http://alloy-alloy-traces.opentelemetry.svc.cluster.local:4318
  java:
    env:
    - name: OTEL_EXPORTER_OTLP_LOGS_ENDPOINT
      value: http://alloy-alloy-logs.opentelemetry.svc.cluster.local:4318
    - name: OTEL_EXPORTER_OTLP_METRICS_ENDPOINT
      value: http://alloy-alloy-metrics.opentelemetry.svc.cluster.local:4318
    - name: OTEL_EXPORTER_OTLP_TRACES_ENDPOINT
      value: http://alloy-alloy-traces.opentelemetry.svc.cluster.local:4318
  nodejs:
    env:
    # - name: OTEL_METRICS_EXPORTER
    #   value: none
    - name: OTEL_EXPORTER_OTLP_LOGS_ENDPOINT
      value: http://alloy-alloy-logs.opentelemetry.svc.cluster.local:4318
    - name: OTEL_EXPORTER_OTLP_METRICS_ENDPOINT
      value: http://alloy-alloy-metrics.opentelemetry.svc.cluster.local:4318
    - name: OTEL_EXPORTER_OTLP_TRACES_ENDPOINT
      value: http://alloy-alloy-traces.opentelemetry.svc.cluster.local:4318
  resource:
    addK8sUIDAttributes: true
    resourceAttributes: {}
